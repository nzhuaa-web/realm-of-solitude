<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯‚å¢ƒç‹æœ - Realm of Solitude</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            overflow: hidden;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            color: #60a5fa;
            text-shadow: 0 0 20px rgba(96, 165, 250, 0.5);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .header .subtitle {
            font-size: 1.2em;
            color: #94a3b8;
            font-style: italic;
        }

        .game-area {
            display: grid;
            grid-template-columns: 280px 1fr 300px;
            gap: 20px;
            height: 600px;
        }

        /* Nopolyé£æ ¼åœ°å›¾ */
        .game-map {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 2px solid #334155;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .tile {
            position: absolute;
            width: 50px;
            height: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }

        /* Nopolyé£æ ¼åœ°å— */
        .tile.grass {
            background: #10b981;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        }

        .tile.forest {
            background: #065f46;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        }

        .tile.water {
            background: #0ea5e9;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        }

        .tile.mountain {
            background: #6b7280;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        }

        /* è‹±é›„æ ·å¼ */
        .hero {
            position: absolute;
            width: 35px;
            height: 35px;
            background: #f59e0b;
            border-radius: 50%;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.5);
            animation: heroPulse 2s ease-in-out infinite;
            cursor: pointer;
        }

        @keyframes heroPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* ç‹ä»¤é¢æ¿ */
        .decree-panel {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid #334155;
        }

        .decree-title {
            font-weight: bold;
            color: #f59e0b;
            margin-bottom: 10px;
            text-align: center;
        }

        .decree-option {
            background: rgba(51, 65, 85, 0.6);
            border: 1px solid #475569;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .decree-option:hover {
            background: rgba(96, 165, 250, 0.3);
            border-color: #60a5fa;
        }

        .decree-option.selected {
            background: rgba(245, 158, 11, 0.3);
            border-color: #f59e0b;
        }

        /* æ•Œäººæ ·å¼ */
        .enemy {
            position: absolute;
            width: 25px;
            height: 25px;
            background: #ef4444;
            border-radius: 50%;
            z-index: 15;
            animation: enemyFloat 3s ease-in-out infinite;
        }

        .enemy.elite {
            background: #dc2626;
            width: 30px;
            height: 30px;
            box-shadow: 0 0 10px rgba(220, 38, 38, 0.5);
        }

        .enemy.boss {
            background: #7c2d12;
            width: 40px;
            height: 40px;
            box-shadow: 0 0 20px rgba(124, 45, 18, 0.7);
        }

        @keyframes enemyFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        /* æŠ€èƒ½æŒ‰é’® */
        .skill-bar {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .skill-btn {
            padding: 8px 12px;
            background: #7c3aed;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease;
            font-size: 0.9em;
        }

        .skill-btn:hover:not(:disabled) {
            background: #6d28d9;
        }

        .skill-btn:disabled {
            background: #475569;
            cursor: not-allowed;
        }

        .skill-btn.cooldown {
            background: #374151;
            color: #9ca3af;
        }

        /* æ˜¼å¤œè§†è§‰æ•ˆæœ - Nopolyé£æ ¼ */
        .day-time {
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
        }

        .night-time {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            filter: brightness(0.7);
        }

        .void-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
            animation: voidPulse 4s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes voidPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        /* === Nopolyé£æ ¼UIç³»ç»Ÿ === */

        /* é¡¶éƒ¨èµ„æºæ  - çµå…‰UIä¸“æ¡ˆè®¾è®¡ */
        .resource-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 10px 20px;
            background: rgba(15, 23, 42, 0.9);
            border-radius: 10px;
            border: 2px solid #334155;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .resource-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .resource-item.aura {
            color: #fbbf24; /* çµå…‰é‡‘è‰² */
            font-weight: 700;
            position: relative;
        }

        .aura-icon {
            font-size: 1.3em;
            animation: auraPulse 2s ease-in-out infinite;
        }

        @keyframes auraPulse {
            0%, 100% { 
                transform: scale(1);
                text-shadow: 0 0 5px rgba(251, 191, 36, 0.5);
            }
            50% { 
                transform: scale(1.1);
                text-shadow: 0 0 15px rgba(251, 191, 36, 0.8);
            }
        }

        .aura-low {
            animation: auraWarning 0.5s ease-in-out 3;
            color: #ef4444 !important;
        }

        @keyframes auraWarning {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* å¤œæ™šè¿›åº¦æ¡ */
        .night-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .wave-indicator {
            display: flex;
            gap: 3px;
        }

        .wave-block {
            width: 8px;
            height: 15px;
            background: #475569;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .wave-block.active {
            background: #60a5fa;
            box-shadow: 0 0 5px rgba(96, 165, 250, 0.5);
        }

        .wave-block.completed {
            background: #10b981;
        }

        /* è‹±é›„çŠ¶æ€é¢æ¿ - å·¦ä¸‹è§’ */
        .hero-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(15, 23, 42, 0.9);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #334155;
            backdrop-filter: blur(10px);
            min-width: 200px;
            z-index: 100;
        }

        .hero-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .hero-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            border: 2px solid #d97706;
        }

        .hero-info {
            flex: 1;
        }

        .hero-name {
            font-weight: 600;
            color: #f59e0b;
        }

        .health-bar {
            width: 100%;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .health-fill.low {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }

        .shield-indicator {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .shield-icon {
            color: #60a5fa;
            font-size: 1.1em;
        }

        /* æŠ€èƒ½æ  - å³ä¸‹è§’ */
        .skill-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .skill-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid #475569;
            background: rgba(15, 23, 42, 0.9);
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .skill-btn:hover:not(:disabled) {
            border-color: #60a5fa;
            transform: scale(1.05);
        }

        .skill-btn:active {
            transform: scale(0.95);
        }

        .skill-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .skill-btn.ultimate {
            width: 80px;
            height: 80px;
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .skill-btn.ultimate.ready {
            animation: ultimateGlow 2s ease-in-out infinite;
            border-color: #fbbf24;
            background: rgba(245, 158, 11, 0.3);
        }

        @keyframes ultimateGlow {
            0%, 100% { 
                box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
            }
            50% { 
                box-shadow: 0 0 20px rgba(245, 158, 11, 0.8);
            }
        }

        /* å†·å´æ•ˆæœ */
        .cooldown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            color: white;
        }

        .cooldown-ring {
            position: absolute;
            top: -2px;
            left: -2px;
            width: calc(100% + 4px);
            height: calc(100% + 4px);
            border-radius: 50%;
            border: 2px solid transparent;
            border-top-color: #60a5fa;
            animation: cooldownSpin 1s linear infinite;
        }

        @keyframes cooldownSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* çµå…‰æ¶ˆè€—æç¤º */
        .aura-cost {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: #fbbf24;
            font-size: 0.9em;
            font-weight: 600;
            white-space: nowrap;
            animation: auraCostFloat 1s ease-out forwards;
        }

        @keyframes auraCostFloat {
            0% { 
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            100% { 
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
        }

        /* æ•Œäººé¢„è­¦ç³»ç»Ÿ */
        .enemy-alert {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 2px solid #ef4444;
            border-radius: 50%;
            animation: alertPulse 1s ease-in-out infinite;
            z-index: 90;
            pointer-events: none;
        }

        @keyframes alertPulse {
            0%, 100% { 
                transform: scale(1);
                opacity: 0.7;
            }
            50% { 
                transform: scale(1.2);
                opacity: 1;
            }
        }

        .enemy-arrow {
            position: absolute;
            font-size: 1.5em;
            color: #ef4444;
            animation: arrowBlink 0.5s ease-in-out infinite;
            z-index: 90;
            pointer-events: none;
        }

        @keyframes arrowBlink {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* å»ºç­‘å—æ”»å‡»æç¤º */
        .building-attack {
            position: absolute;
            animation: buildingShake 0.3s ease-in-out;
            border: 2px solid #ef4444 !important;
        }

        @keyframes buildingShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .attack-icon {
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 1.2em;
            color: #ef4444;
            animation: iconPulse 0.5s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .hero-panel {
                bottom: 10px;
                left: 10px;
                padding: 10px;
                min-width: 160px;
            }
            
            .skill-panel {
                bottom: 10px;
                right: 10px;
            }
            
            .skill-btn {
                width: 50px;
                height: 50px;
            }
            
            .skill-btn.ultimate {
                width: 65px;
                height: 65px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>å¯‚å¢ƒç‹æœ</h1>
            <div class="subtitle">Realm of Solitude - åœ¨è™šç©ºè¾¹ç¼˜é‡å»ºå¸Œæœ›</div>
        </div>

        <div class="day-counter">
            ç¬¬ <span id="day">1</span> å¤© | 
            <span id="timeOfDay">ç™½å¤©</span> | 
            å…³å¡: <span id="level">1</span>
        </div>

        <div class="game-area">
            <div class="legend-panel">
                <h3>ç‹ä»¤é€‰æ‹©</h3>
                <div class="decree-panel" id="decreePanel">
                    <div class="decree-title">é€‰æ‹©3ä¸ªç‹ä»¤å¼€å§‹æ¸¸æˆ</div>
                    <!-- ç‹ä»¤é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <div class="goal-panel">
                    <div class="goal-title">æ¸¸æˆç›®æ ‡</div>
                    <div class="goal-item">âœ“ ç”Ÿå­˜10ä¸ªæ˜¼å¤œå¾ªç¯</div>
                    <div class="goal-item">âœ“ æŠµå¾¡è™šç©ºå·¨æ½®</div>
                    <div class="goal-item">âœ“ å»ºç«‹ç¨³å®šé˜²çº¿</div>
                    <div class="goal-item">âœ“ å‡çº§è‹±é›„èƒ½åŠ›</div>
                </div>

                <div class="skill-bar" id="skillBar">
                    <!-- æŠ€èƒ½æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="game-map" id="gameMap">
                <div class="void-effect" id="voidEffect"></div>
                <!-- åœ°å›¾å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <div class="stats-panel">
                <h3>å­¤ç‹çŠ¶æ€</h3>
                <div class="resource">
                    <span class="resource-name">çµå…‰èƒ½é‡</span>
                    <span class="resource-value" id="aura">100</span>
                </div>
                <div class="resource">
                    <span class="resource-name">é‡‘å¸</span>
                    <span class="resource-value" id="gold">50</span>
                </div>
                <div class="resource">
                    <span class="resource-name">æœ¨æ</span>
                    <span class="resource-value" id="wood">25</span>
                </div>
                <div class="resource">
                    <span class="resource-name">äººå£</span>
                    <span class="resource-value" id="population">5</span>
                </div>
                <div class="resource">
                    <span class="resource-name">è‹±é›„ç­‰çº§</span>
                    <span class="resource-value" id="heroLevel">1</span>
                </div>

                <div class="actions-panel">
                    <button class="action-btn" onclick="gatherAura()">é‡‡é›†çµå…‰</button>
                    <button class="action-btn" onclick="buildStructure('farm')">å»ºé€ å†œåœº</button>
                    <button class="action-btn" onclick="buildStructure('tower')">å»ºé€ ç®­å¡”</button>
                    <button class="action-btn" onclick="buildStructure('barracks')">å»ºé€ å…µè¥</button>
                    <button class="action-btn" onclick="upgradeHero()">å‡çº§è‹±é›„</button>
                    <button class="action-btn" onclick="nextPhase()">è¿›å…¥ä¸‹ä¸€é˜¶æ®µ</button>
                    <button class="action-btn" onclick="restartGame()" style="background: #f59e0b;">é‡æ–°å¼€å§‹</button>
                </div>
            </div>
        </div>

        <div class="event-log" id="eventLog">
            <div class="event neutral">è™šç©ºé£æš´å·²å¹³æ¯ï¼Œå¼€å§‹é‡å»ºä½ çš„ç‹æœ...</div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€ - æŒ‰ç…§ç­–åˆ’æ¡ˆé‡æ„
        let gameState = {
            level: 1,
            day: 1,
            phase: 'day', // day or night
            resources: {
                aura: 100,    // çµå…‰èƒ½é‡
                gold: 50,     // é‡‘å¸
                wood: 25,     // æœ¨æ
                population: 5 // äººå£
            },
            hero: {
                level: 1,
                health: 100,
                skills: ['basicAttack', 'defensiveStance'],
                experience: 0
            },
            decrees: [],      // é€‰æ‹©çš„ç‹ä»¤
            buildings: [],
            enemies: [],
            events: []
        };

        // ç‹ä»¤ç³»ç»Ÿ - ç±»ä¼¼å¡ç»„é€‰æ‹©
        const availableDecrees = [
            {
                id: 'economicFocus',
                name: 'ç»æµä¼˜å…ˆ',
                description: 'æ‰€æœ‰å†œåœºæ”¶ç›Š+30%',
                effect: () => gameState.resources.aura *= 1.3
            },
            {
                id: 'knightHonor', 
                name: 'éª‘å£«è£è€€',
                description: 'éª‘å…µè·å¾—å†²é”‹å‡»é€€æ•ˆæœ',
                effect: () => console.log('éª‘å£«è£è€€æ¿€æ´»')
            },
            {
                id: 'steelDefense',
                name: 'é’¢é“é˜²çº¿', 
                description: 'åŸå¢™è€ä¹…+50%',
                effect: () => console.log('é’¢é“é˜²çº¿æ¿€æ´»')
            },
            {
                id: 'nightWalker',
                name: 'å¤œè¡Œè€…',
                description: 'è‹±é›„å¤œæˆ˜è·å¾—é¢å¤–ä¼¤å®³',
                effect: () => console.log('å¤œè¡Œè€…æ¿€æ´»')
            },
            {
                id: 'auraProtection',
                name: 'çµå…‰æŠ¤ä¸»',
                description: 'æ­»äº¡ä¸€æ¬¡å…æ­»',
                effect: () => console.log('çµå…‰æŠ¤ä¸»æ¿€æ´»')
            }
        ];

        // æ•Œäººç±»å‹ - æŒ‰ç…§ç­–åˆ’æ¡ˆè®¾è®¡
        const enemyTypes = {
            voidBeast: {
                name: 'è™šç©ºå°å…½',
                health: 30,
                damage: 5,
                speed: 1,
                description: 'æ•°é‡å¤šã€ç ´åå¢™å¿«'
            },
            voidCharger: {
                name: 'è™šç©ºå†²é”‹å…½', 
                health: 50,
                damage: 10,
                speed: 2,
                description: 'é«˜é€Ÿã€ç›´çº¿å†²ç ´é˜²çº¿'
            },
            corrosionCrab: {
                name: 'è…èš€èŸ¹',
                health: 40,
                damage: 8,
                speed: 0.8,
                description: 'å¯¹å»ºç­‘æœ‰é¢å¤–ä¼¤å®³'
            },
            nightArcher: {
                name: 'å¤œå½±å¼“æ‰‹',
                health: 35,
                damage: 12,
                speed: 1.2,
                description: 'è¿œç¨‹å¨èƒè‹±é›„'
            },
            voidColossus: {
                name: 'è™šç©ºå·¨çµ',
                health: 200,
                damage: 25,
                speed: 0.5,
                description: 'Bossçº§æ•Œäººï¼Œéœ€åˆåŠ›å‡»è´¥'
            }
        };

        // å»ºç­‘ç³»ç»Ÿ
        const buildingTypes = {
            farm: {
                name: 'å†œåœº',
                cost: { wood: 10, gold: 5 },
                production: { aura: 5 },
                description: 'ç¨³å®šäº§å‡ºçµå…‰èƒ½é‡'
            },
            tower: {
                name: 'ç®­å¡”', 
                cost: { wood: 15, gold: 10 },
                defense: 20,
                description: 'è¿œç¨‹æ”»å‡»æ•Œäºº'
            },
            barracks: {
                name: 'å…µè¥',
                cost: { wood: 20, gold: 15 },
                population: 3,
                description: 'è®­ç»ƒåŸºç¡€å£«å…µ'
            },
            wall: {
                name: 'åŸå¢™',
                cost: { wood: 5 },
                defense: 30,
                description: 'é˜»æŒ¡æ•Œäººå‰è¿›'
            }
        };

        // è‹±é›„æŠ€èƒ½
        const heroSkills = {
            basicAttack: {
                name: 'åŸºç¡€æ”»å‡»',
                cost: 0,
                cooldown: 1,
                effect: 'å¯¹å•ä¸ªæ•Œäººé€ æˆä¼¤å®³'
            },
            defensiveStance: {
                name: 'é˜²å¾¡å§¿æ€',
                cost: 10,
                cooldown: 3,
                effect: 'æå‡é˜²å¾¡åŠ›3å›åˆ'
            },
            auraStrike: {
                name: 'çµå…‰æ‰“å‡»',
                cost: 25,
                cooldown: 5,
                effect: 'èŒƒå›´æ”»å‡»ï¼Œæ¶ˆè€—çµå…‰èƒ½é‡'
            }
        };

        // åˆå§‹åŒ–ç‹ä»¤é€‰æ‹©
        function initDecreeSelection() {
            const decreePanel = document.getElementById('decreePanel');
            decreePanel.innerHTML = '<div class="decree-title">é€‰æ‹©3ä¸ªç‹ä»¤å¼€å§‹æ¸¸æˆ</div>';
            
            availableDecrees.forEach(decree => {
                const option = document.createElement('div');
                option.className = 'decree-option';
                option.setAttribute('data-decree-id', decree.id);
                option.innerHTML = `
                    <strong>${decree.name}</strong><br>
                    <small>${decree.description}</small>
                `;
                option.onclick = () => selectDecree(decree);
                decreePanel.appendChild(option);
            });
            
            // æ·»åŠ å¼€å§‹æ¸¸æˆæŒ‰é’®
            const startButton = document.createElement('button');
            startButton.className = 'action-btn';
            startButton.textContent = 'å¼€å§‹æ¸¸æˆ';
            startButton.style.marginTop = '10px';
            startButton.onclick = startGame;
            decreePanel.appendChild(startButton);
        }

        // é€‰æ‹©ç‹ä»¤
        function selectDecree(decree) {
            if (gameState.decrees.length >= 3) {
                addEvent('å·²é€‰æ‹©3ä¸ªç‹ä»¤ï¼Œè¯·ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®', 'neutral');
                return;
            }
            
            if (!gameState.decrees.includes(decree.id)) {
                gameState.decrees.push(decree.id);
                decree.effect();
                addEvent(`é€‰æ‹©äº†ç‹ä»¤: ${decree.name} (${gameState.decrees.length}/3)`, 'positive');
                
                // æ›´æ–°UIæ˜¾ç¤ºå·²é€‰æ‹©
                const options = document.querySelectorAll('.decree-option');
                options.forEach(opt => {
                    if (opt.getAttribute('data-decree-id') === decree.id) {
                        opt.classList.add('selected');
                    }
                });
                updateUI();
            } else {
                addEvent('å·²ç»é€‰æ‹©äº†è¿™ä¸ªç‹ä»¤', 'neutral');
            }
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameState.decrees.length < 3) {
                addEvent(`è¯·é€‰æ‹©3ä¸ªç‹ä»¤æ‰èƒ½å¼€å§‹æ¸¸æˆ (å½“å‰: ${gameState.decrees.length}/3)`, 'negative');
                return;
            }
            
            addEvent('æ¸¸æˆå¼€å§‹ï¼ä½¿ç”¨ä½ çš„ç‹ä»¤ç­–ç•¥å»ºç«‹é˜²çº¿...', 'positive');
            
            // å¯ç”¨æ‰€æœ‰æ¸¸æˆåŠŸèƒ½
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.disabled = false;
            });
            
            // éšè—ç‹ä»¤é€‰æ‹©é¢æ¿
            document.getElementById('decreePanel').style.display = 'none';
        }

        // ç”ŸæˆNopolyé£æ ¼åœ°å›¾
        function generateNopolyMap() {
            const mapElement = document.getElementById('gameMap');
            mapElement.innerHTML = '';
            
            const mapConfig = {
                width: 12,
                height: 8,
                tileSize: 50
            };

            // æ·»åŠ è™šç©ºæ•ˆæœ
            const voidEffect = document.createElement('div');
            voidEffect.className = 'void-effect';
            voidEffect.id = 'voidEffect';
            mapElement.appendChild(voidEffect);

            // ç”Ÿæˆå…­è¾¹å½¢ç½‘æ ¼
            for (let y = 0; y < mapConfig.height; y++) {
                for (let x = 0; x < mapConfig.width; x++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    
                    // éšæœºåœ°å—ç±»å‹
                    const types = ['grass', 'forest', 'water', 'mountain'];
                    const type = types[Math.floor(Math.random() * types.length)];
                    tile.classList.add(type);
                    
                    // å…­è¾¹å½¢å¸ƒå±€è®¡ç®—
                    const hexX = x * mapConfig.tileSize * 0.866; // cos(30Â°)
                    const hexY = y * mapConfig.tileSize + (x % 2) * mapConfig.tileSize / 2;
                    
                    tile.style.position = 'absolute';
                    tile.style.left = hexX + 'px';
                    tile.style.top = hexY + 'px';
                    tile.style.width = mapConfig.tileSize + 'px';
                    tile.style.height = mapConfig.tileSize + 'px';
                    tile.style.cursor = 'pointer';
                    tile.style.zIndex = '5';
                    
                    tile.addEventListener('click', () => onTileClick(x, y, type));
                    mapElement.appendChild(tile);
                }
            }

            // æ”¾ç½®è‹±é›„
            placeHero();
        }

        // åœ°å—ç‚¹å‡»äº‹ä»¶
        function onTileClick(x, y, type) {
            if (gameState.decrees.length < 3) {
                addEvent('è¯·å…ˆé€‰æ‹©3ä¸ªç‹ä»¤å¼€å§‹æ¸¸æˆ', 'negative');
                return;
            }
            
            if (gameState.phase === 'day') {
                addEvent(`é€‰æ‹©äº†${getTileName(type)}åœ°å— (${x}, ${y}) - å¯ä»¥åœ¨æ­¤å»ºé€ å»ºç­‘`, 'neutral');
            } else {
                addEvent(`å¤œæ™šæ— æ³•å»ºé€ ï¼Œè¯·ç­‰å¾…å¤©äº®`, 'negative');
            }
        }

        // è·å–åœ°å—åç§°
        function getTileName(type) {
            const names = {
                'grass': 'è‰åœ°',
                'forest': 'æ£®æ—', 
                'water': 'æ°´åŸŸ',
                'mountain': 'å±±è„‰'
            };
            return names[type] || 'æœªçŸ¥åœ°å—';
        }

        // é‡‡é›†çµå…‰èƒ½é‡
        function gatherAura() {
            if (gameState.decrees.length < 3) {
                addEvent('è¯·å…ˆé€‰æ‹©3ä¸ªç‹ä»¤å¼€å§‹æ¸¸æˆ', 'negative');
                return;
            }
            
            if (gameState.phase === 'day') {
                const gathered = Math.floor(Math.random() * 15) + 10;
                gameState.resources.aura += gathered;
                addEvent(`é‡‡é›†åˆ° ${gathered} ç‚¹çµå…‰èƒ½é‡`, 'positive');
                updateUI();
            } else {
                addEvent('åªèƒ½åœ¨ç™½å¤©é‡‡é›†èµ„æº', 'negative');
            }
        }

        // æ£€æŸ¥æ˜¯å¦èƒ½å¤Ÿæ”¯ä»˜
        function canAfford(cost) {
            return Object.keys(cost).every(resource => 
                gameState.resources[resource] >= cost[resource]
            );
        }

        // è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼ˆç™½å¤©/é»‘å¤œåˆ‡æ¢ï¼‰
        function nextPhase() {
            if (gameState.decrees.length < 3) {
                addEvent('è¯·å…ˆé€‰æ‹©3ä¸ªç‹ä»¤å¼€å§‹æ¸¸æˆ', 'negative');
                return;
            }
            
            if (gameState.phase === 'day') {
                // åˆ‡æ¢åˆ°å¤œæ™š
                gameState.phase = 'night';
                document.getElementById('timeOfDay').textContent = 'å¤œæ™š';
                document.body.classList.add('night-time');
                document.body.classList.remove('day-time');
                
                addEvent('å¤œå¹•é™ä¸´ï¼Œè™šç©ºç”Ÿç‰©å¼€å§‹æ´»åŠ¨...', 'negative');
                startNightPhase();
            } else {
                // åˆ‡æ¢åˆ°ç™½å¤©
                gameState.phase = 'day';
                gameState.day++;
                document.getElementById('timeOfDay').textContent = 'ç™½å¤©';
                document.getElementById('day').textContent = gameState.day;
                document.body.classList.add('day-time');
                document.body.classList.remove('night-time');
                
                // å¯ç”¨å»ºé€ æŒ‰é’®
                document.querySelectorAll('.action-btn').forEach(btn => {
                    btn.disabled = false;
                });
                
                // æ¸…é™¤å¤œæ™šçš„æ•Œäºº
                gameState.enemies.forEach(enemy => enemy.element.remove());
                gameState.enemies = [];
                
                addEvent(`ç¬¬${gameState.day}å¤©å¼€å§‹ï¼Œç»§ç»­å»ºè®¾ä½ çš„ç‹æœ`, 'positive');
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆå…³å¡
                if (gameState.day > 10) {
                    completeLevel();
                }
            }
            updateUI();
        }

        // æ”¾ç½®è‹±é›„
        function placeHero() {
            const mapElement = document.getElementById('gameMap');
            const hero = document.createElement('div');
            hero.className = 'hero';
            hero.innerHTML = 'ğŸ‘‘';
            hero.style.left = '300px';
            hero.style.top = '200px';
            hero.onclick = () => showHeroInfo();
            mapElement.appendChild(hero);
        }

        // æ˜¾ç¤ºè‹±é›„ä¿¡æ¯
        function showHeroInfo() {
            if (gameState.decrees.length < 3) {
                addEvent('è¯·å…ˆé€‰æ‹©3ä¸ªç‹ä»¤å¼€å§‹æ¸¸æˆ', 'negative');
                return;
            }
            
            const heroInfo = `
å­¤ç‹çŠ¶æ€:
ç­‰çº§: ${gameState.hero.level}
ç”Ÿå‘½å€¼: ${gameState.hero.health}
ç»éªŒå€¼: ${gameState.hero.experience}
æŠ€èƒ½: ${gameState.hero.skills.join(', ')}
ç‹ä»¤æ•ˆæœ: ${gameState.decrees.join(', ')}
            `;
            
            addEvent(heroInfo, 'positive');
            
            // æ˜¾ç¤ºæŠ€èƒ½é¢æ¿
            showSkillPanel();
        }

        // æ˜¾ç¤ºæŠ€èƒ½é¢æ¿
        function showSkillPanel() {
            const skillBar = document.getElementById('skillBar');
            skillBar.innerHTML = '<div class="decree-title">è‹±é›„æŠ€èƒ½</div>';
            
            Object.keys(heroSkills).forEach(skillKey => {
                const skill = heroSkills[skillKey];
                const skillBtn = document.createElement('button');
                skillBtn.className = 'skill-btn';
                skillBtn.textContent = `${skill.name} (æ¶ˆè€—:${skill.cost})`;
                skillBtn.onclick = () => useSkill(skillKey);
                
                // æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨æŠ€èƒ½
                if (gameState.resources.aura < skill.cost) {
                    skillBtn.disabled = true;
                    skillBtn.title = `éœ€è¦${skill.cost}ç‚¹çµå…‰èƒ½é‡`;
                }
                
                skillBar.appendChild(skillBtn);
            });
        }

        // ä½¿ç”¨æŠ€èƒ½ - å¢å¼ºç‰ˆNopolyé£æ ¼
        function useSkill(skillKey) {
            const skill = heroSkills[skillKey];
            const skillBtn = document.querySelector(`.skill-btn[data-skill="${skillKey}"]`);
            
            if (!skillBtn) return;
            
            // æ£€æŸ¥çµå…‰æ˜¯å¦è¶³å¤Ÿ
            if (gameState.resources.aura < skill.cost) {
                addEvent(`çµå…‰èƒ½é‡ä¸è¶³ï¼éœ€è¦${skill.cost}ç‚¹èƒ½é‡ä½¿ç”¨${skill.name}`, 'negative');
                
                // çµå…‰ä¸è¶³æç¤ºåŠ¨ç”»
                skillBtn.classList.add('aura-low');
                setTimeout(() => {
                    skillBtn.classList.remove('aura-low');
                }, 500);
                return;
            }
            
            // çµå…‰æ¶ˆè€—
            gameState.resources.aura -= skill.cost;
            
            // æ˜¾ç¤ºçµå…‰æ¶ˆè€—åŠ¨ç”»
            showAuraCostAnimation(skill.cost, skillBtn);
            
            // æŠ€èƒ½å†·å´æ•ˆæœ
            startSkillCooldown(skillKey, skillBtn);
            
            // æ‰§è¡ŒæŠ€èƒ½æ•ˆæœ
            let skillEffect = '';
            
            switch(skillKey) {
                case 'basicAttack':
                    if (gameState.enemies.length > 0) {
                        const randomEnemy = gameState.enemies[Math.floor(Math.random() * gameState.enemies.length)];
                        skillEffect = `ä½¿ç”¨${skill.name}æ”»å‡»äº†${enemyTypes[randomEnemy.type]?.name || 'æ•Œäºº'}ï¼`;
                        
                        // æ•Œäººå—å‡»æ•ˆæœ
                        showEnemyHitEffect(randomEnemy.element);
                        
                        // å‡å°‘æ•Œäººç”Ÿå‘½å€¼
                        randomEnemy.health -= 15;
                        if (randomEnemy.health <= 0) {
                            randomEnemy.element.remove();
                            gameState.enemies = gameState.enemies.filter(e => e !== randomEnemy);
                            skillEffect += ' æ•Œäººè¢«å‡»è´¥ï¼';
                        }
                    } else {
                        skillEffect = `ä½¿ç”¨${skill.name}ï¼Œä½†æ²¡æœ‰å‘ç°æ•Œäºº`;
                    }
                    break;
                    
                case 'defensiveStance':
                    skillEffect = `ä½¿ç”¨${skill.name}ï¼Œè‹±é›„é˜²å¾¡åŠ›æå‡ï¼`;
                    gameState.hero.health += 20;
                    
                    // é˜²å¾¡ç‰¹æ•ˆ
                    showDefenseEffect();
                    break;
                    
                case 'auraStrike':
                    if (gameState.enemies.length > 0) {
                        skillEffect = `ä½¿ç”¨${skill.name}ï¼Œå¯¹å¤šä¸ªæ•Œäººé€ æˆèŒƒå›´ä¼¤å®³ï¼`;
                        
                        // èŒƒå›´æ”»å‡»ç‰¹æ•ˆ
                        showAuraStrikeEffect();
                        
                        // ç§»é™¤ä¸€äº›æ•Œäºº
                        const enemiesToRemove = Math.min(3, gameState.enemies.length);
                        for (let i = 0; i < enemiesToRemove; i++) {
                            if (gameState.enemies[i]) {
                                showEnemyHitEffect(gameState.enemies[i].element);
                                gameState.enemies[i].element.remove();
                            }
                        }
                        gameState.enemies.splice(0, enemiesToRemove);
                    } else {
                        skillEffect = `ä½¿ç”¨${skill.name}ï¼Œä½†æ²¡æœ‰å‘ç°æ•Œäºº`;
                    }
                    break;
            }
            
            addEvent(skillEffect, 'positive');
            updateUI();
        }

        // æŠ€èƒ½å†·å´ç³»ç»Ÿ
        function startSkillCooldown(skillKey, skillBtn) {
            const skill = heroSkills[skillKey];
            
            // ç¦ç”¨æŒ‰é’®
            skillBtn.disabled = true;
            
            // æ·»åŠ å†·å´è¦†ç›–å±‚
            const cooldownOverlay = document.createElement('div');
            cooldownOverlay.className = 'cooldown-overlay';
            cooldownOverlay.textContent = skill.cooldown + 's';
            
            const cooldownRing = document.createElement('div');
            cooldownRing.className = 'cooldown-ring';
            
            skillBtn.appendChild(cooldownOverlay);
            skillBtn.appendChild(cooldownRing);
            
            // å†·å´è®¡æ—¶å™¨
            let remainingTime = skill.cooldown;
            const cooldownInterval = setInterval(() => {
                remainingTime--;
                cooldownOverlay.textContent = remainingTime + 's';
                
                if (remainingTime <= 0) {
                    clearInterval(cooldownInterval);
                    cooldownOverlay.remove();
                    cooldownRing.remove();
                    skillBtn.disabled = false;
                }
            }, 1000);
        }

        // æ•Œäººå—å‡»æ•ˆæœ
        function showEnemyHitEffect(enemyElement) {
            enemyElement.style.animation = 'none';
            setTimeout(() => {
                enemyElement.style.animation = 'enemyFloat 3s ease-in-out infinite';
            }, 10);
            
            enemyElement.style.border = '2px solid #f59e0b';
            enemyElement.style.boxShadow = '0 0 15px rgba(245, 158, 11, 0.8)';
            
            setTimeout(() => {
                enemyElement.style.border = '';
                enemyElement.style.boxShadow = '';
            }, 300);
        }

        // é˜²å¾¡ç‰¹æ•ˆ
        function showDefenseEffect() {
            const heroPanel = document.querySelector('.hero-panel');
            if (heroPanel) {
                heroPanel.style.borderColor = '#60a5fa';
                heroPanel.style.boxShadow = '0 0 20px rgba(96, 165, 250, 0.5)';
                
                setTimeout(() => {
                    heroPanel.style.borderColor = '';
                    heroPanel.style.boxShadow = '';
                }, 1000);
            }
        }

        // çµå…‰æ‰“å‡»ç‰¹æ•ˆ
        function showAuraStrikeEffect() {
            const mapElement = document.getElementById('gameMap');
            const strikeEffect = document.createElement('div');
            strikeEffect.style.position = 'absolute';
            strikeEffect.style.top = '50%';
            strikeEffect.style.left = '50%';
            strikeEffect.style.transform = 'translate(-50%, -50%)';
            strikeEffect.style.width = '200px';
            strikeEffect.style.height = '200px';
            strikeEffect.style.background = 'radial-gradient(circle, rgba(251, 191, 36, 0.3) 0%, transparent 70%)';
            strikeEffect.style.borderRadius = '50%';
            strikeEffect.style.animation = 'auraStrikeExpand 0.5s ease-out forwards';
            strikeEffect.style.zIndex = '25';
            strikeEffect.style.pointerEvents = 'none';
            
            mapElement.appendChild(strikeEffect);
            
            setTimeout(() => {
                strikeEffect.remove();
            }, 500);
        }

        // åˆå§‹åŒ–æ¸¸æˆæ—¶æ·»åŠ Nopoly UI
        function initGame() {
            initDecreeSelection();
            generateNopolyMap();
            initNopolyUI(); // åˆå§‹åŒ–Nopoly UIç³»ç»Ÿ
            updateUI();
            
            // è®¾ç½®æ˜¼å¤œè§†è§‰æ•ˆæœ
            document.body.classList.add('day-time');
        }

        // å¼€å§‹å¤œæ™šé˜¶æ®µ - å¢å¼ºç‰ˆ
        function startNightPhase() {
            // åˆ‡æ¢åˆ°å¤œæ™šè§†è§‰
            gameState.phase = 'night';
            document.getElementById('timeOfDay').textContent = 'å¤œæ™š';
            document.body.classList.add('night-time');
            document.body.classList.remove('day-time');
            
            // ç”Ÿæˆæ•Œäººæ³¢æ¬¡
            generateEnemyWave();
            
            // ç¦ç”¨å»ºé€ æŒ‰é’®
            document.querySelectorAll('.action-btn').forEach(btn => {
                if (!btn.textContent.includes('ä¸‹ä¸€é˜¶æ®µ') && !btn.textContent.includes('é‡æ–°å¼€å§‹')) {
                    btn.disabled = true;
                }
            });
            
            // å¼€å§‹æ•Œäººç§»åŠ¨å’Œé¢„è­¦ç³»ç»Ÿ
            startEnemyMovement();
            startEnemyAlertSystem();
            
            addEvent('å¤œå¹•é™ä¸´ï¼è™šç©ºç”Ÿç‰©æ­£åœ¨æ¥è¿‘...', 'negative');
            updateUI();
        }

        // æ•Œäººé¢„è­¦ç³»ç»Ÿ
        function startEnemyAlertSystem() {
            const alertInterval = setInterval(() => {
                if (gameState.phase !== 'night') {
                    clearInterval(alertInterval);
                    return;
                }
                
                // ä¸ºæ¯ä¸ªæ•Œäººæ˜¾ç¤ºé¢„è­¦
                gameState.enemies.forEach(enemy => {
                    showEnemyAlert(enemy);
                    showEnemyDirection(enemy);
                });
                
            }, 2000); // æ¯2ç§’æ›´æ–°ä¸€æ¬¡é¢„è­¦
        }

        // å¼€å§‹æ•Œäººç§»åŠ¨
        function startEnemyMovement() {
            const moveInterval = setInterval(() => {
                if (gameState.phase !== 'night') {
                    clearInterval(moveInterval);
                    return;
                }
                
                gameState.enemies.forEach((enemy, index) => {
                    // ç®€å•ç§»åŠ¨é€»è¾‘ï¼šå‘åœ°å›¾ä¸­å¿ƒç§»åŠ¨
                    const currentLeft = parseInt(enemy.element.style.left);
                    const currentTop = parseInt(enemy.element.style.top);
                    const centerX = 250;
                    const centerY = 200;
                    
                    const dx = centerX - currentLeft;
                    const dy = centerY - currentTop;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 10) {
                        const speed = enemy.speed || 1;
                        const moveX = (dx / distance) * speed;
                        const moveY = (dy / distance) * speed;
                        
                        enemy.element.style.left = (currentLeft + moveX) + 'px';
                        enemy.element.style.top = (currentTop + moveY) + 'px';
                    } else {
                        // æ•Œäººåˆ°è¾¾ä¸­å¿ƒï¼Œé€ æˆä¼¤å®³
                        gameState.hero.health -= enemy.damage || 5;
                        addEvent(`${enemyTypes[enemy.type]?.name || 'æ•Œäºº'}æ”»å‡»äº†è‹±é›„ï¼ç”Ÿå‘½å€¼-${enemy.damage || 5}`, 'negative');
                        
                        // æ˜¾ç¤ºè‹±é›„å—å‡»æ•ˆæœ
                        showHeroHitEffect();
                        
                        // ç§»é™¤æ•Œäºº
                        enemy.element.remove();
                        gameState.enemies.splice(index, 1);
                        
                        // æ£€æŸ¥æ¸¸æˆç»“æŸ
                        if (gameState.hero.health <= 0) {
                            gameOver();
                        }
                    }
                });
                
                updateUI();
            }, 100);
        }

        // è‹±é›„å—å‡»æ•ˆæœ
        function showHeroHitEffect() {
            const heroPanel = document.querySelector('.hero-panel');
            if (heroPanel) {
                heroPanel.style.borderColor = '#ef4444';
                heroPanel.style.boxShadow = '0 0 20px rgba(239, 68, 68, 0.5)';
                
                setTimeout(() => {
                    heroPanel.style.borderColor = '';
                    heroPanel.style.boxShadow = '';
                }, 300);
            }
        }

        // æ·»åŠ çµå…‰æ‰“å‡»åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes auraStrikeExpand {
                0% { 
                    transform: translate(-50%, -50%) scale(0);
                    opacity: 1;
                }
                100% { 
                    transform: translate(-50%, -50%) scale(2);
                    opacity: 0;
                }
            }
            
            .aura-low {
                animation: auraWarning 0.5s ease-in-out 3 !important;
                border-color: #ef4444 !important;
            }
        `;
        document.head.appendChild(style);

        // å‡çº§è‹±é›„
        function upgradeHero() {
            if (gameState.decrees.length < 3) {
                addEvent('è¯·å…ˆé€‰æ‹©3ä¸ªç‹ä»¤å¼€å§‹æ¸¸æˆ', 'negative');
                return;
            }
            
            if (gameState.resources.aura >= 50) {
                gameState.resources.aura -= 50;
                gameState.hero.level++;
                gameState.hero.health += 20;
                gameState.hero.experience += 100;
                
                // éšæœºè§£é”æ–°æŠ€èƒ½
                const availableSkills = Object.keys(heroSkills).filter(skill => 
                    !gameState.hero.skills.includes(skill)
                );
                if (availableSkills.length > 0) {
                    const newSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
                    gameState.hero.skills.push(newSkill);
                    addEvent(`è‹±é›„å‡çº§åˆ°ç­‰çº§ ${gameState.hero.level}ï¼è§£é”æ–°æŠ€èƒ½: ${heroSkills[newSkill].name}`, 'positive');
                } else {
                    addEvent(`è‹±é›„å‡çº§åˆ°ç­‰çº§ ${gameState.hero.level}ï¼`, 'positive');
                }
                
                updateUI();
            } else {
                addEvent('éœ€è¦50ç‚¹çµå…‰èƒ½é‡æ‰èƒ½å‡çº§è‹±é›„', 'negative');
            }
        }

        // åœ°å—ç‚¹å‡»äº‹ä»¶
        function onTileClick(x, y, type) {
            if (gameState.phase === 'day') {
                addEvent(`é€‰æ‹©äº†${getTileName(type)}åœ°å— (${x}, ${y})`, 'neutral');
            }
        }

        // è·å–åœ°å—åç§°
        function getTileName(type) {
            const names = {
                'grass': 'è‰åœ°',
                'forest': 'æ£®æ—', 
                'water': 'æ°´åŸŸ',
                'mountain': 'å±±è„‰'
            };
            return names[type] || 'æœªçŸ¥åœ°å—';
        }

        // é‡‡é›†çµå…‰èƒ½é‡
        function gatherAura() {
            if (gameState.phase === 'day') {
                const gathered = Math.floor(Math.random() * 15) + 10;
                gameState.resources.aura += gathered;
                addEvent(`é‡‡é›†åˆ° ${gathered} ç‚¹çµå…‰èƒ½é‡`, 'positive');
                updateUI();
            } else {
                addEvent('åªèƒ½åœ¨ç™½å¤©é‡‡é›†èµ„æº', 'negative');
            }
        }

        // å»ºé€ å»ºç­‘
        function buildStructure(type) {
            if (gameState.decrees.length < 3) {
                addEvent('è¯·å…ˆé€‰æ‹©3ä¸ªç‹ä»¤å¼€å§‹æ¸¸æˆ', 'negative');
                return;
            }
            
            if (gameState.phase === 'day') {
                const building = buildingTypes[type];
                if (!building) {
                    addEvent(`æœªçŸ¥å»ºç­‘ç±»å‹: ${type}`, 'negative');
                    return;
                }
                
                if (canAfford(building.cost)) {
                    // æ‰£é™¤èµ„æº
                    Object.keys(building.cost).forEach(resource => {
                        gameState.resources[resource] -= building.cost[resource];
                    });
                    
                    gameState.buildings.push({
                        type: type,
                        ...building,
                        position: { x: Math.floor(Math.random() * 8), y: Math.floor(Math.random() * 6) }
                    });
                    
                    // åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºå»ºç­‘
                    addBuildingToMap(type);
                    
                    addEvent(`å»ºé€ äº†${building.name}ï¼Œæ¶ˆè€—${JSON.stringify(building.cost)}`, 'positive');
                    updateUI();
                } else {
                    const missing = Object.keys(building.cost).filter(resource => 
                        gameState.resources[resource] < building.cost[resource]
                    );
                    addEvent(`èµ„æºä¸è¶³ï¼Œæ— æ³•å»ºé€ ${building.name}ã€‚ç¼ºå°‘: ${missing.join(', ')}`, 'negative');
                }
            } else {
                addEvent('åªèƒ½åœ¨ç™½å¤©å»ºé€ å»ºç­‘ï¼Œè¯·ç­‰å¾…å¤©äº®', 'negative');
            }
        }

        // åœ¨åœ°å›¾ä¸Šæ·»åŠ å»ºç­‘
        function addBuildingToMap(type) {
            const mapElement = document.getElementById('gameMap');
            const building = document.createElement('div');
            building.className = 'building';
            building.classList.add(type);
            
            const buildingConfig = {
                farm: { emoji: 'ğŸŒ¾', color: '#10b981' },
                tower: { emoji: 'ğŸ¹', color: '#ef4444' },
                barracks: { emoji: 'âš”ï¸', color: '#f59e0b' },
                wall: { emoji: 'ğŸ§±', color: '#6b7280' }
            };
            
            const config = buildingConfig[type] || { emoji: 'ğŸ ', color: '#94a3b8' };
            
            building.innerHTML = config.emoji;
            building.style.position = 'absolute';
            building.style.left = Math.random() * 500 + 'px';
            building.style.top = Math.random() * 400 + 'px';
            building.style.width = '40px';
            building.style.height = '40px';
            building.style.background = config.color;
            building.style.borderRadius = '5px';
            building.style.display = 'flex';
            building.style.alignItems = 'center';
            building.style.justifyContent = 'center';
            building.style.fontSize = '20px';
            building.style.zIndex = '10';
            building.style.cursor = 'pointer';
            
            building.onclick = () => {
                addEvent(`ç‚¹å‡»äº†${buildingTypes[type]?.name || 'å»ºç­‘'}`, 'neutral');
            };
            
            mapElement.appendChild(building);
        }

        // æ£€æŸ¥æ˜¯å¦èƒ½å¤Ÿæ”¯ä»˜
        function canAfford(cost) {
            return Object.keys(cost).every(resource => 
                gameState.resources[resource] >= cost[resource]
            );
        }

        // å‡çº§è‹±é›„
        function upgradeHero() {
            if (gameState.resources.aura >= 50) {
                gameState.resources.aura -= 50;
                gameState.hero.level++;
                gameState.hero.health += 20;
                addEvent(`è‹±é›„å‡çº§åˆ°ç­‰çº§ ${gameState.hero.level}`, 'positive');
                updateUI();
            } else {
                addEvent('éœ€è¦50ç‚¹çµå…‰èƒ½é‡æ‰èƒ½å‡çº§è‹±é›„', 'negative');
            }
        }

        // è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼ˆç™½å¤©/é»‘å¤œåˆ‡æ¢ï¼‰
        function nextPhase() {
            if (gameState.phase === 'day') {
                // åˆ‡æ¢åˆ°å¤œæ™š
                gameState.phase = 'night';
                document.getElementById('timeOfDay').textContent = 'å¤œæ™š';
                document.body.classList.add('night-time');
                document.body.classList.remove('day-time');
                
                addEvent('å¤œå¹•é™ä¸´ï¼Œè™šç©ºç”Ÿç‰©å¼€å§‹æ´»åŠ¨...', 'negative');
                startNightPhase();
            } else {
                // åˆ‡æ¢åˆ°ç™½å¤©
                gameState.phase = 'day';
                gameState.day++;
                document.getElementById('timeOfDay').textContent = 'ç™½å¤©';
                document.getElementById('day').textContent = gameState.day;
                document.body.classList.add('day-time');
                document.body.classList.remove('night-time');
                
                addEvent('æ–°çš„ä¸€å¤©å¼€å§‹ï¼Œç»§ç»­å»ºè®¾ä½ çš„ç‹æœ', 'positive');
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆå…³å¡
                if (gameState.day > 10) {
                    completeLevel();
                }
            }
            updateUI();
        }

        // å¼€å§‹å¤œæ™šé˜¶æ®µ
        function startNightPhase() {
            // ç”Ÿæˆæ•Œäººæ³¢æ¬¡
            generateEnemyWave();
            
            // ç¦ç”¨å»ºé€ æŒ‰é’®
            document.querySelectorAll('.action-btn').forEach(btn => {
                if (!btn.textContent.includes('ä¸‹ä¸€é˜¶æ®µ') && !btn.textContent.includes('é‡æ–°å¼€å§‹')) {
                    btn.disabled = true;
                }
            });
            
            // å¼€å§‹æ•Œäººç§»åŠ¨
            startEnemyMovement();
            
            addEvent('å¤œæ™šå¼€å§‹ï¼è™šç©ºç”Ÿç‰©æ­£åœ¨æ¥è¿‘...', 'negative');
        }

        // ç”Ÿæˆæ•Œäººæ³¢æ¬¡
        function generateEnemyWave() {
            const waveSize = Math.min(3 + gameState.day, 8); // éšå¤©æ•°å¢åŠ 
            
            for (let i = 0; i < waveSize; i++) {
                const enemyTypesArray = Object.keys(enemyTypes);
                const randomType = enemyTypesArray[Math.floor(Math.random() * enemyTypesArray.length)];
                spawnEnemy(randomType);
            }
            
            // ç¬¬10å¤©ç”ŸæˆBoss
            if (gameState.day === 10) {
                spawnEnemy('voidColossus');
                addEvent('è™šç©ºå·¨çµå‡ºç°ï¼æœ€ç»ˆå†³æˆ˜å¼€å§‹', 'negative');
            }
        }

        // ç”Ÿæˆæ•Œäºº
        function spawnEnemy(type) {
            const mapElement = document.getElementById('gameMap');
            const enemy = document.createElement('div');
            enemy.className = 'enemy';
            enemy.setAttribute('data-enemy-type', type);
            
            if (type === 'voidColossus') {
                enemy.classList.add('boss');
                enemy.innerHTML = 'ğŸ‘¹';
            } else if (Math.random() < 0.2) {
                enemy.classList.add('elite');
                enemy.innerHTML = 'ğŸ’€';
            } else {
                enemy.innerHTML = 'ğŸ‘»';
            }
            
            // æ•Œäººä»åœ°å›¾è¾¹ç¼˜å‡ºç°
            const side = Math.floor(Math.random() * 4);
            let left, top;
            
            switch(side) {
                case 0: // ä¸Šè¾¹
                    left = Math.random() * 500;
                    top = -50;
                    break;
                case 1: // å³è¾¹
                    left = 550;
                    top = Math.random() * 400;
                    break;
                case 2: // ä¸‹è¾¹
                    left = Math.random() * 500;
                    top = 450;
                    break;
                case 3: // å·¦è¾¹
                    left = -50;
                    top = Math.random() * 400;
                    break;
            }
            
            enemy.style.left = left + 'px';
            enemy.style.top = top + 'px';
            enemy.style.position = 'absolute';
            enemy.style.width = '35px';
            enemy.style.height = '35px';
            enemy.style.borderRadius = '50%';
            enemy.style.display = 'flex';
            enemy.style.alignItems = 'center';
            enemy.style.justifyContent = 'center';
            enemy.style.fontSize = '20px';
            enemy.style.zIndex = '15';
            enemy.style.cursor = 'pointer';
            
            enemy.onclick = () => {
                addEvent(`ç‚¹å‡»äº†${enemyTypes[type]?.name || 'æ•Œäºº'} (${type})`, 'neutral');
            };
            
            mapElement.appendChild(enemy);
            gameState.enemies.push({
                element: enemy,
                type: type,
                health: enemyTypes[type].health,
                ...enemyTypes[type]
            });
        }

        // å¼€å§‹æ•Œäººç§»åŠ¨
        function startEnemyMovement() {
            const moveInterval = setInterval(() => {
                if (gameState.phase !== 'night') {
                    clearInterval(moveInterval);
                    return;
                }
                
                gameState.enemies.forEach((enemy, index) => {
                    // ç®€å•ç§»åŠ¨é€»è¾‘ï¼šå‘åœ°å›¾ä¸­å¿ƒç§»åŠ¨
                    const currentLeft = parseInt(enemy.element.style.left);
                    const currentTop = parseInt(enemy.element.style.top);
                    const centerX = 250;
                    const centerY = 200;
                    
                    const dx = centerX - currentLeft;
                    const dy = centerY - currentTop;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 10) {
                        const speed = enemy.speed || 1;
                        const moveX = (dx / distance) * speed;
                        const moveY = (dy / distance) * speed;
                        
                        enemy.element.style.left = (currentLeft + moveX) + 'px';
                        enemy.element.style.top = (currentTop + moveY) + 'px';
                    } else {
                        // æ•Œäººåˆ°è¾¾ä¸­å¿ƒï¼Œé€ æˆä¼¤å®³
                        gameState.hero.health -= enemy.damage || 5;
                        addEvent(`${enemyTypes[enemy.type]?.name || 'æ•Œäºº'}æ”»å‡»äº†è‹±é›„ï¼ç”Ÿå‘½å€¼-${enemy.damage || 5}`, 'negative');
                        
                        // ç§»é™¤æ•Œäºº
                        enemy.element.remove();
                        gameState.enemies.splice(index, 1);
                        
                        // æ£€æŸ¥æ¸¸æˆç»“æŸ
                        if (gameState.hero.health <= 0) {
                            gameOver();
                        }
                    }
                });
                
                updateUI();
            }, 100);
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            addEvent('è‹±é›„è¢«å‡»è´¥ï¼æ¸¸æˆç»“æŸ', 'negative');
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.disabled = true;
            });
        }

        // å®Œæˆå…³å¡
        function completeLevel() {
            addEvent(`æ­å–œï¼æˆåŠŸç”Ÿå­˜10å¤©ï¼Œå®Œæˆç¬¬${gameState.level}å…³`, 'positive');
            gameState.level++;
            gameState.day = 1;
            addEvent(`è¿›å…¥ç¬¬${gameState.level}å…³ï¼ŒæŒ‘æˆ˜å‡çº§`, 'neutral');
        }

        // æ·»åŠ äº‹ä»¶åˆ°æ—¥å¿—
        function addEvent(message, type) {
            const eventElement = document.createElement('div');
            eventElement.className = `event ${type}`;
            eventElement.textContent = `[${gameState.phase.toUpperCase()}] ${message}`;
            
            const eventLog = document.getElementById('eventLog');
            eventLog.appendChild(eventElement);
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        // æ›´æ–°UI - Nopolyé£æ ¼å¤œæ™šæ¨¡å¼
        function updateUI() {
            // æ›´æ–°èµ„æºæ˜¾ç¤º
            updateResourceBar();
            
            // æ›´æ–°è‹±é›„çŠ¶æ€
            updateHeroPanel();
            
            // æ›´æ–°æŠ€èƒ½æ 
            updateSkillPanel();
            
            // æ›´æ–°å¤œæ™šè¿›åº¦
            updateNightProgress();
            
            // æ£€æŸ¥çµå…‰çŠ¶æ€
            checkAuraStatus();
        }

        // æ›´æ–°èµ„æºæ 
        function updateResourceBar() {
            const auraElement = document.getElementById('auraValue');
            const goldElement = document.getElementById('goldValue');
            const woodElement = document.getElementById('woodValue');
            
            if (auraElement) auraElement.textContent = gameState.resources.aura;
            if (goldElement) goldElement.textContent = gameState.resources.gold;
            if (woodElement) woodElement.textContent = gameState.resources.wood;
        }

        // æ›´æ–°è‹±é›„é¢æ¿
        function updateHeroPanel() {
            const healthFill = document.getElementById('healthFill');
            const shieldIndicator = document.getElementById('shieldIndicator');
            const heroLevel = document.getElementById('heroLevel');
            
            if (healthFill) {
                const healthPercent = (gameState.hero.health / 100) * 100;
                healthFill.style.width = healthPercent + '%';
                
                // ä½è¡€é‡è­¦å‘Š
                if (gameState.hero.health <= 30) {
                    healthFill.classList.add('low');
                } else {
                    healthFill.classList.remove('low');
                }
            }
            
            if (shieldIndicator) {
                // ç®€å•æŠ¤ç›¾æ˜¾ç¤ºï¼ˆå¯æ ¹æ®å®é™…æŠ¤ç›¾å€¼æ‰©å±•ï¼‰
                shieldIndicator.innerHTML = '';
                const shieldCount = Math.floor(gameState.hero.health / 25);
                for (let i = 0; i < shieldCount; i++) {
                    const shieldIcon = document.createElement('span');
                    shieldIcon.className = 'shield-icon';
                    shieldIcon.textContent = 'â—‡';
                    shieldIndicator.appendChild(shieldIcon);
                }
            }
            
            if (heroLevel) {
                heroLevel.textContent = gameState.hero.level;
            }
        }

        // æ›´æ–°æŠ€èƒ½é¢æ¿
        function updateSkillPanel() {
            const skillButtons = document.querySelectorAll('.skill-btn');
            skillButtons.forEach(btn => {
                const skillKey = btn.getAttribute('data-skill');
                if (skillKey) {
                    const skill = heroSkills[skillKey];
                    
                    // æ£€æŸ¥çµå…‰æ˜¯å¦è¶³å¤Ÿ
                    if (gameState.resources.aura < skill.cost) {
                        btn.disabled = true;
                        btn.title = `éœ€è¦${skill.cost}ç‚¹çµå…‰èƒ½é‡`;
                    } else {
                        btn.disabled = false;
                        btn.title = skill.effect;
                    }
                    
                    // å¤§æ‹›ç‰¹æ®Šæ•ˆæœ
                    if (skillKey === 'auraStrike') {
                        if (gameState.resources.aura >= skill.cost) {
                            btn.classList.add('ready');
                        } else {
                            btn.classList.remove('ready');
                        }
                    }
                }
            });
        }

        // æ›´æ–°å¤œæ™šè¿›åº¦
        function updateNightProgress() {
            const waveBlocks = document.querySelectorAll('.wave-block');
            const totalWaves = 6; // å‡è®¾6æ³¢æ•Œäºº
            const currentWave = Math.min(Math.floor(gameState.day / 2), totalWaves);
            
            waveBlocks.forEach((block, index) => {
                if (index < currentWave) {
                    block.classList.add('completed');
                    block.classList.remove('active');
                } else if (index === currentWave) {
                    block.classList.add('active');
                    block.classList.remove('completed');
                } else {
                    block.classList.remove('active', 'completed');
                }
            });
        }

        // æ£€æŸ¥çµå…‰çŠ¶æ€
        function checkAuraStatus() {
            const auraElement = document.getElementById('auraValue');
            if (auraElement) {
                if (gameState.resources.aura < 20) {
                    auraElement.classList.add('aura-low');
                } else {
                    auraElement.classList.remove('aura-low');
                }
            }
        }

        // çµå…‰æ¶ˆè€—åŠ¨ç”»
        function showAuraCostAnimation(skillCost, element) {
            const costElement = document.createElement('div');
            costElement.className = 'aura-cost';
            costElement.textContent = `-${skillCost} âœ¦`;
            
            element.appendChild(costElement);
            
            setTimeout(() => {
                costElement.remove();
            }, 1000);
        }

        // æ•Œäººé¢„è­¦ç³»ç»Ÿ
        function showEnemyAlert(enemy) {
            const mapElement = document.getElementById('gameMap');
            const alertElement = document.createElement('div');
            alertElement.className = 'enemy-alert';
            
            // æ ¹æ®æ•Œäººä½ç½®æ˜¾ç¤ºé¢„è­¦
            const enemyRect = enemy.element.getBoundingClientRect();
            const mapRect = mapElement.getBoundingClientRect();
            
            const relativeX = enemyRect.left - mapRect.left;
            const relativeY = enemyRect.top - mapRect.top;
            
            alertElement.style.left = relativeX + 'px';
            alertElement.style.top = relativeY + 'px';
            
            mapElement.appendChild(alertElement);
            
            setTimeout(() => {
                alertElement.remove();
            }, 2000);
        }

        // æ˜¾ç¤ºæ•Œäººæ–¹å‘ç®­å¤´
        function showEnemyDirection(enemy) {
            const mapElement = document.getElementById('gameMap');
            const arrowElement = document.createElement('div');
            arrowElement.className = 'enemy-arrow';
            
            // è®¡ç®—æ•Œäººç›¸å¯¹äºå±å¹•è¾¹ç¼˜çš„æ–¹å‘
            const enemyRect = enemy.element.getBoundingClientRect();
            const mapRect = mapElement.getBoundingClientRect();
            
            const centerX = mapRect.width / 2;
            const centerY = mapRect.height / 2;
            const enemyX = enemyRect.left - mapRect.left + enemyRect.width / 2;
            const enemyY = enemyRect.top - mapRect.top + enemyRect.height / 2;
            
            // ç¡®å®šç®­å¤´æ–¹å‘
            let arrowSymbol = 'â†’';
            if (enemyX < centerX - 100) arrowSymbol = 'â†';
            if (enemyY < centerY - 100) arrowSymbol = 'â†‘';
            if (enemyY > centerY + 100) arrowSymbol = 'â†“';
            
            arrowElement.textContent = arrowSymbol;
            
            // æ”¾ç½®åœ¨å±å¹•è¾¹ç¼˜
            if (arrowSymbol === 'â†’') {
                arrowElement.style.right = '10px';
                arrowElement.style.top = enemyY + 'px';
            } else if (arrowSymbol === 'â†') {
                arrowElement.style.left = '10px';
                arrowElement.style.top = enemyY + 'px';
            } else if (arrowSymbol === 'â†‘') {
                arrowElement.style.top = '10px';
                arrowElement.style.left = enemyX + 'px';
            } else {
                arrowElement.style.bottom = '10px';
                arrowElement.style.left = enemyX + 'px';
            }
            
            mapElement.appendChild(arrowElement);
            
            setTimeout(() => {
                arrowElement.remove();
            }, 1000);
        }

        // å»ºç­‘å—æ”»å‡»æ•ˆæœ
        function showBuildingAttack(building) {
            const buildingElement = document.querySelector(`.building.${building.type}`);
            if (buildingElement) {
                buildingElement.classList.add('building-attack');
                
                // æ·»åŠ æ”»å‡»å›¾æ ‡
                const attackIcon = document.createElement('div');
                attackIcon.className = 'attack-icon';
                attackIcon.textContent = 'âš”';
                buildingElement.appendChild(attackIcon);
                
                setTimeout(() => {
                    buildingElement.classList.remove('building-attack');
                    attackIcon.remove();
                }, 1000);
            }
        }

        // åˆå§‹åŒ–Nopoly UIç³»ç»Ÿ
        function initNopolyUI() {
            // åˆ›å»ºèµ„æºæ 
            const gameContainer = document.querySelector('.game-container');
            const resourceBar = document.createElement('div');
            resourceBar.className = 'resource-bar';
            resourceBar.innerHTML = `
                <div class="resource-item">
                    <span>ğŸ’°</span>
                    <span id="goldValue">${gameState.resources.gold}</span>
                </div>
                <div class="resource-item">
                    <span>ğŸŒ²</span>
                    <span id="woodValue">${gameState.resources.wood}</span>
                </div>
                <div class="resource-item aura">
                    <span class="aura-icon">âœ¦</span>
                    <span id="auraValue">${gameState.resources.aura}</span>
                </div>
                <div class="night-progress">
                    <span>ç¬¬${gameState.day}å¤œ:</span>
                    <div class="wave-indicator">
                        <div class="wave-block"></div>
                        <div class="wave-block"></div>
                        <div class="wave-block"></div>
                        <div class="wave-block"></div>
                        <div class="wave-block"></div>
                        <div class="wave-block"></div>
                    </div>
                </div>
            `;
            
            // æ’å…¥åˆ°æ¸¸æˆå®¹å™¨é¡¶éƒ¨
            const header = document.querySelector('.header');
            gameContainer.insertBefore(resourceBar, header.nextSibling);
            
            // åˆ›å»ºè‹±é›„é¢æ¿
            const heroPanel = document.createElement('div');
            heroPanel.className = 'hero-panel';
            heroPanel.innerHTML = `
                <div class="hero-header">
                    <div class="hero-avatar">ğŸ‘‘</div>
                    <div class="hero-info">
                        <div class="hero-name">å­¤ç‹</div>
                        <div class="health-bar">
                            <div class="health-fill" id="healthFill"></div>
                        </div>
                        <div class="shield-indicator" id="shieldIndicator"></div>
                    </div>
                </div>
                <div>ç­‰çº§: <span id="heroLevel">${gameState.hero.level}</span></div>
            `;
            
            document.body.appendChild(heroPanel);
            
            // åˆ›å»ºæŠ€èƒ½é¢æ¿
            const skillPanel = document.createElement('div');
            skillPanel.className = 'skill-panel';
            skillPanel.innerHTML = `
                <button class="skill-btn" data-skill="basicAttack" title="åŸºç¡€æ”»å‡»">âš”</button>
                <button class="skill-btn" data-skill="defensiveStance" title="é˜²å¾¡å§¿æ€">ğŸ›¡</button>
                <button class="skill-btn ultimate" data-skill="auraStrike" title="çµå…‰æ‰“å‡»">âœ¨</button>
            `;
            
            document.body.appendChild(skillPanel);
            
            // ç»‘å®šæŠ€èƒ½äº‹ä»¶
            const skillButtons = skillPanel.querySelectorAll('.skill-btn');
            skillButtons.forEach(btn => {
                const skillKey = btn.getAttribute('data-skill');
                btn.onclick = () => useSkill(skillKey);
            });
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸¢å¤±ã€‚')) {
                gameState = {
                    level: 1,
                    day: 1,
                    phase: 'day',
                    resources: {
                        aura: 100,
                        gold: 50,
                        wood: 25,
                        population: 5
                    },
                    hero: {
                        level: 1,
                        health: 100,
                        skills: ['basicAttack', 'defensiveStance'],
                        experience: 0
                    },
                    decrees: [],
                    buildings: [],
                    enemies: [],
                    events: []
                };
                
                const eventLog = document.getElementById('eventLog');
                eventLog.innerHTML = '<div class="event neutral">æ¸¸æˆé‡æ–°å¼€å§‹ï¼é€‰æ‹©ä½ çš„ç‹ä»¤...</div>';
                
                initDecreeSelection();
                generateNopolyMap();
                updateUI();
            }
        }

        // åˆå§‹åŒ–Nopoly UIç³»ç»Ÿ
        function initNopolyUI() {
            // åˆ›å»ºèµ„æºæ 
            const gameContainer = document.querySelector('.game-container');
            const resourceBar = document.createElement('div');
            resourceBar.className = 'resource-bar';
            resourceBar.innerHTML = `
                <div class="resource-item">
                    <span>ğŸ’°</span>
                    <span id="goldValue">${gameState.resources.gold}</span>
                </div>
                <div class="resource-item">
                    <span>ğŸŒ²</span>
                    <span id="woodValue">${gameState.resources.wood}</span>
                </div>
                <div class="resource-item aura">
                    <span class="aura-icon">âœ¦</span>
                    <span id="auraValue">${gameState.resources.aura}</span>
                </div>
                <div class="night-progress">
                    <span>ç¬¬${gameState.day}å¤œ:</span>
                    <div class="wave-indicator">
                        <div class="wave-block"></div>
                        <div class="wave-block"></div>
                        <div class="wave-block"></div>
                        <div class="wave-block"></div>
                        <div class="wave-block"></div>
                        <div class="wave-block"></div>
                    </div>
                </div>
            `;
            
            // æ’å…¥åˆ°æ¸¸æˆå®¹å™¨é¡¶éƒ¨
            const header = document.querySelector('.header');
            gameContainer.insertBefore(resourceBar, header.nextSibling);
            
            // åˆ›å»ºè‹±é›„é¢æ¿
            const heroPanel = document.createElement('div');
            heroPanel.className = 'hero-panel';
            heroPanel.innerHTML = `
                <div class="hero-header">
                    <div class="hero-avatar">ğŸ‘‘</div>
                    <div class="hero-info">
                        <div class="hero-name">å­¤ç‹</div>
                        <div class="health-bar">
                            <div class="health-fill" id="healthFill"></div>
                        </div>
                        <div class="shield-indicator" id="shieldIndicator"></div>
                    </div>
                </div>
                <div>ç­‰çº§: <span id="heroLevel">${gameState.hero.level}</span></div>
            `;
            
            document.body.appendChild(heroPanel);
            
            // åˆ›å»ºæŠ€èƒ½é¢æ¿
            const skillPanel = document.createElement('div');
            skillPanel.className = 'skill-panel';
            skillPanel.innerHTML = `
                <button class="skill-btn" data-skill="basicAttack" title="åŸºç¡€æ”»å‡»">âš”</button>
                <button class="skill-btn" data-skill="defensiveStance" title="é˜²å¾¡å§¿æ€">ğŸ›¡</button>
                <button class="skill-btn ultimate" data-skill="auraStrike" title="çµå…‰æ‰“å‡»">âœ¨</button>
            `;
            
            document.body.appendChild(skillPanel);
            
            // ç»‘å®šæŠ€èƒ½äº‹ä»¶
            const skillButtons = skillPanel.querySelectorAll('.skill-btn');
            skillButtons.forEach(btn => {
                const skillKey = btn.getAttribute('data-skill');
                btn.onclick = () => useSkill(skillKey);
            });
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            initDecreeSelection();
            generateNopolyMap();
            initNopolyUI();
            updateUI();
            
            // è®¾ç½®æ˜¼å¤œè§†è§‰æ•ˆæœ
            document.body.classList.add('day-time');
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = initGame;

        // ä¿®å¤å‡½æ•°è°ƒç”¨é—®é¢˜
        function generateNopolyMap() {
            const mapElement = document.getElementById('gameMap');
            mapElement.innerHTML = '';
            
            const mapConfig = {
                width: 12,
                height: 8,
                tileSize: 50
            };

            // æ·»åŠ è™šç©ºæ•ˆæœ
            const voidEffect = document.createElement('div');
            voidEffect.className = 'void-effect';
            voidEffect.id = 'voidEffect';
            mapElement.appendChild(voidEffect);

            // ç”Ÿæˆå…­è¾¹å½¢ç½‘æ ¼
            for (let y = 0; y < mapConfig.height; y++) {
                for (let x = 0; x < mapConfig.width; x++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    
                    // éšæœºåœ°å—ç±»å‹
                    const types = ['grass', 'forest', 'water', 'mountain'];
                    const type = types[Math.floor(Math.random() * types.length)];
                    tile.classList.add(type);
                    
                    // å…­è¾¹å½¢å¸ƒå±€è®¡ç®—
                    const hexX = x * mapConfig.tileSize * 0.866; // cos(30Â°)
                    const hexY = y * mapConfig.tileSize + (x % 2) * mapConfig.tileSize / 2;
                    
                    tile.style.position = 'absolute';
                    tile.style.left = hexX + 'px';
                    tile.style.top = hexY + 'px';
                    tile.style.width = mapConfig.tileSize + 'px';
                    tile.style.height = mapConfig.tileSize + 'px';
                    tile.style.cursor = 'pointer';
                    tile.style.zIndex = '5';
                    
                    tile.addEventListener('click', () => onTileClick(x, y, type));
                    mapElement.appendChild(tile);
                }
            }

            // æ”¾ç½®è‹±é›„
            placeHero();
        }

        // æ”¾ç½®è‹±é›„
        function placeHero() {
            const mapElement = document.getElementById('gameMap');
            const hero = document.createElement('div');
            hero.className = 'hero';
            hero.innerHTML = 'ğŸ‘‘';
            hero.style.left = '300px';
            hero.style.top = '200px';
            hero.onclick = () => showHeroInfo();
            mapElement.appendChild(hero);
        }

        // åœ°å—ç‚¹å‡»äº‹ä»¶
        function onTileClick(x, y, type) {
            if (gameState.decrees.length < 3) {
                addEvent('è¯·å…ˆé€‰æ‹©3ä¸ªç‹ä»¤å¼€å§‹æ¸¸æˆ', 'negative');
                return;
            }
            
            if (gameState.phase === 'day') {
                addEvent(`é€‰æ‹©äº†${getTileName(type)}åœ°å— (${x}, ${y}) - å¯ä»¥åœ¨æ­¤å»ºé€ å»ºç­‘`, 'neutral');
            } else {
                addEvent(`å¤œæ™šæ— æ³•å»ºé€ ï¼Œè¯·ç­‰å¾…å¤©äº®`, 'negative');
            }
        }

        // è·å–åœ°å—åç§°
        function getTileName(type) {
            const names = {
                'grass': 'è‰åœ°',
                'forest': 'æ£®æ—', 
                'water': 'æ°´åŸŸ',
                'mountain': 'å±±è„‰'
            };
            return names[type] || 'æœªçŸ¥åœ°å—';
        }

        // é‡‡é›†çµå…‰èƒ½é‡
        function gatherAura() {
            if (gameState.decrees.length < 3) {
                addEvent('è¯·å…ˆé€‰æ‹©3ä¸ªç‹ä»¤å¼€å§‹æ¸¸æˆ', 'negative');
                return;
            }
            
            if (gameState.phase === 'day') {
                const gathered = Math.floor(Math.random() * 15) + 10;
                gameState.resources.aura += gathered;
                addEvent(`é‡‡é›†åˆ° ${gathered} ç‚¹çµå…‰èƒ½é‡`, 'positive');
                updateUI();
            } else {
                addEvent('åªèƒ½åœ¨ç™½å¤©é‡‡é›†èµ„æº', 'negative');
            }
        }

        // è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼ˆç™½å¤©/é»‘å¤œåˆ‡æ¢ï¼‰
        function nextPhase() {
            if (gameState.decrees.length < 3) {
                addEvent('è¯·å…ˆé€‰æ‹©3ä¸ªç‹ä»¤å¼€å§‹æ¸¸æˆ', 'negative');
                return;
            }
            
            if (gameState.phase === 'day') {
                // åˆ‡æ¢åˆ°å¤œæ™š
                gameState.phase = 'night';
                document.getElementById('timeOfDay').textContent = 'å¤œæ™š';
                document.body.classList.add('night-time');
                document.body.classList.remove('day-time');
                
                addEvent('å¤œå¹•é™ä¸´ï¼Œè™šç©ºç”Ÿç‰©å¼€å§‹æ´»åŠ¨...', 'negative');
                startNightPhase();
            } else {
                // åˆ‡æ¢åˆ°ç™½å¤©
                gameState.phase = 'day';
                gameState.day++;
                document.getElementById('timeOfDay').textContent = 'ç™½å¤©';
                document.getElementById('day').textContent = gameState.day;
                document.body.classList.add('day-time');
                document.body.classList.remove('night-time');
                
                // å¯ç”¨å»ºé€ æŒ‰é’®
                document.querySelectorAll('.action-btn').forEach(btn => {
                    btn.disabled = false;
                });
                
                // æ¸…é™¤å¤œæ™šçš„æ•Œäºº
                gameState.enemies.forEach(enemy => enemy.element.remove());
                gameState.enemies = [];
                
                addEvent(`ç¬¬${gameState.day}å¤©å¼€å§‹ï¼Œç»§ç»­å»ºè®¾ä½ çš„ç‹æœ`, 'positive');
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆå…³å¡
                if (gameState.day > 10) {
                    completeLevel();
                }
            }
            updateUI();
        }
    </script>
</body>
</html>